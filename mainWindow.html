<!DOCTYPE html>
<html lang="en">
<head>
    <title>Dallar</title>
    <!--<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/css/materialize.min.css">-->
    <link href="assets/stylesheet.css" rel="stylesheet" type="text/css">
</head>
<body>
    <nav>
        <div style="text-align: center">
            <img src="assets/icons/png/icon.png" style="width:100px;height:100px;" ></img>
        </div>
    </nav>
    <div class="wrapper" id="system:info">
        
        <div class="grid grid1" id="systemInfoCpu">
            System CPU
            <ul>
                <strong>Manufacturer:</strong><br><li id="systemInfoCpuManufacturer"></li>
                <strong>Brand:</strong><br><li id="systemInfoCpuBrand"></li>
                <strong>Cores:</strong><br><li id="systemInfoCpuCores"></li>
            </ul>
        </div>
        <div class="grid grid2" id="systemInfoGraphics">
                System Graphics
                <ul>
                    <strong>Vendor:</strong><br><li id="systemInfoGraphicsVendor"></li>
                    <strong>Model:</strong><br><li id="systemInfoGraphicsModel"></li>
                    <strong>VRAM:</strong><br><li id="systemInfoGraphicsVram"></li>
                </ul>
        </div>
        <div class="grid grid3" id="systemInfoNetworkInterfaces">
            System Network
            <ul>
                <strong>Iface:</strong><br><li id="systemInfoNetworkInterfacesIface"></li>
                <strong>MAC: </strong><br><li id="systemInfoNetworkInterfacesMac"></li>
                <strong>IP:</strong><br><li id="systemInfoNetworkInterfacesIp"></li>
            </ul>
        </div>
        <div class="grid grid4" id="poolInfo">
            Miner Pool
            <form id="mining">
                <div>
                    Mining Settings
                    <label >User: </label>
                        <input type="text" id="miningUser" style="width: 100%;" autofocus value="Lern5ErqdGcBJW42Je4szXVhpbgtwLVvJA ">
                    <label >User PassWord: </label>
                        <input type="text" id="miningUserPw" style="width: 100%;" value="x">
                    <label >Pool: </label>
                        <input type="text" id="miningPool" style="width: 100%;" value="stratum+tcp://ltc.poolmining.org:3042">
                    <label >Algo: </label>
                        <input type="text" id="miningAlgo" style="width: 100%;" value="scrypt">
                </div>
            </form>
        </div>
    </div>
    <div  id="chooseDevice">
        Device to Use: 
        <form>
            <input type="radio" name="miningDevice" onchange="hideGpuDeviceSettings(this)" value="CPU" checked>CPU<br>
            <input type="radio" name="miningDevice" onchange="hideCpuDeviceSettings(this)" value="GPU" > GPU<br>
        </form> 
    </div>
    
    <div id="DeviceSettings">
        <div>
            <form id="cpuDeviceSettings" style="visibility: visble;">
                <div style="width:50%" class="grid">
                    <label>Number of Cores/Threads to use:<br> Recommended is half when Idle <br> </label> 
                        <input type="range" onchange="updateThread(this.value)" min="1" max="2" value="1" class="slider" id="cpuThreadSlider" >
                        <input type="number" onchange="updateThread(this.value)" value="1" id="cpuThreadSliderValue" style="width: 40px; height: 100%;">
                </div>
                <script>
                    function updateThread(val){
                        
                        document.getElementById("cpuThreadSlider").value = val;
                        document.getElementById("cpuThreadSliderValue").value = val;
                    }
                </script>
            </form>  
        </div>

        <div class="clearfix:after"></div>

        <div>
            <form id="gpuDeviceSettings" style="visibility: hidden;">
                    <input type="range" min="1" max="100" value="50" class="slider" id="myRange">
            </form> 
        </div>

        <script>
            function hideCpuDeviceSettings(x) {
                if (x.checked) {
                    document.getElementById("cpuDeviceSettings").style.visibility = "hidden";
                    document.getElementById("gpuDeviceSettings").style.visibility = "visible";
                }
            }function hideGpuDeviceSettings(x) {
                if (x.checked) {
                    document.getElementById("gpuDeviceSettings").style.visibility = "hidden";
                    document.getElementById("cpuDeviceSettings").style.visibility = "visible";
                }
            }
        </script>
    </div>
    <br><br><br>
    <div>
            <div style="text-align:center"><strong >Mining Stats</strong><br><br></div>


            <strong>Stratum Difficulty: </strong><br>
            <div class="cpuCore cpuTemp"><strong>Stratum Difficulty set to:</strong><br> 
                <div id="miningStatsStratDiff"></div>
            </div>
            <br>
            <strong>Hash Rates: </strong><br>
            <div class="cpuCore cpuTemp" id="cpuHash"><strong>CPU Hash:</strong><br> 
                <div id="miningStatsCpuHash"></div>
            </div>
    
            <div class="cpuCoreWrapper" >
                    <div class="cpuCore cpuCore0" id="cpuCore0Hash"><strong>Core 0</strong><br> <div id="miningStatsCpuCore0Hash"></div></div>
                    <div class="cpuCore cpuCore1" id="cpuCore1Hash"><strong>Core 1</strong><br> <div id="miningStatsCpuCore1Hash"></div></div>
                    <div class="cpuCore cpuCore2" id="cpuCore2Hash"><strong>Core 2</strong><br> <div id="miningStatsCpuCore2Hash"></div></div>
                    <div class="cpuCore cpuCore3" id="cpuCore3Hash"><strong>Core 3</strong><br> <div id="miningStatsCpuCore3Hash"></div></div>
                    <div class="cpuCore cpuCore4" id="cpuCore4Hash"><strong>Core 4</strong><br> <div id="miningStatsCpuCore4Hash"></div></div>
                    <div class="cpuCore cpuCore5" id="cpuCore5Hash"><strong>Core 5</strong><br> <div id="miningStatsCpuCore5Hash"></div></div>
                    <div class="cpuCore cpuCore6" id="cpuCore6Hash"><strong>Core 6</strong><br> <div id="miningStatsCpuCore6Hash"></div></div>
                    <div class="cpuCore cpuCore7" id="cpuCore7Hash"><strong>Core 7</strong><br> <div id="miningStatsCpuCore7Hash"></div></div>
    
                </ul>
            </div>
    </div>
    <br><br>
    <div >
            <div style="text-align:center"><strong>CPU Stats</strong><br><br> </div>

       
        <strong>Temperature: </strong><br>
        <div class="cpuCore cpuTemp" id="cpuTemp"><strong>CPU Temperature:</strong><br> 
            <div id="systemStatsCpuTemp"></div>
        </div>
        <div class="cpuCoreWrapper" id="systemStatsCurrentLoad">
                <div class="cpuCore cpuCore0" id="cpuCore0Temp"><strong>Core 0</strong><br> <div id="systemStatsCpuCore0Temp"></div></div>
                <div class="cpuCore cpuCore1" id="cpuCore1Temp"><strong>Core 1</strong><br> <div id="systemStatsCpuCore1Temp"></div></div>
                <div class="cpuCore cpuCore2" id="cpuCore2Temp"><strong>Core 2</strong><br> <div id="systemStatsCpuCore2Temp"></div></div>
                <div class="cpuCore cpuCore3" id="cpuCore3Temp"><strong>Core 3</strong><br> <div id="systemStatsCpuCore3Temp"></div></div>
                <div class="cpuCore cpuCore4" id="cpuCore4Temp"><strong>Core 4</strong><br> <div id="systemStatsCpuCore4Temp"></div></div>
                <div class="cpuCore cpuCore5" id="cpuCore5Temp"><strong>Core 5</strong><br> <div id="systemStatsCpuCore5Temp"></div></div>
                <div class="cpuCore cpuCore6" id="cpuCore6Temp"><strong>Core 6</strong><br> <div id="systemStatsCpuCore6Temp"></div></div>
                <div class="cpuCore cpuCore7" id="cpuCore7Temp"><strong>Core 7</strong><br> <div id="systemStatsCpuCore7Temp"></div></div>

            </ul>
        </div>
        <br>
        <strong>Usage: </strong><br>
        <div class="cpuCore cpuTemp" id="cpuTemp"><strong>CPU Load:</strong><br>
            <div id="systemStatsCurrentLoadCpu"></div>
        </div>
        <div class="cpuCoreWrapper" id="systemStatsCurrentLoad">
                    <div class="cpuCore cpuCore0" id="cpuCore0"><strong>Core 0</strong><br> <div id="systemStatsCurrentLoadCpuCore0"></div></div>
                    <div class="cpuCore cpuCore1" id="cpuCore1"><strong>Core 1</strong><br> <div id="systemStatsCurrentLoadCpuCore1"></div></div>
                    <div class="cpuCore cpuCore2" id="cpuCore2"><strong>Core 2</strong><br> <div id="systemStatsCurrentLoadCpuCore2"></div></div>
                    <div class="cpuCore cpuCore3" id="cpuCore3"><strong>Core 3</strong><br> <div id="systemStatsCurrentLoadCpuCore3"></div></div>
                    <div class="cpuCore cpuCore4" id="cpuCore4"><strong>Core 4</strong><br> <div id="systemStatsCurrentLoadCpuCore4"></div></div>
                    <div class="cpuCore cpuCore5" id="cpuCore5"><strong>Core 5</strong><br> <div id="systemStatsCurrentLoadCpuCore5"></div></div>
                    <div class="cpuCore cpuCore6" id="cpuCore6"><strong>Core 6</strong><br> <div id="systemStatsCurrentLoadCpuCore6"></div></div>
                    <div class="cpuCore cpuCore7" id="cpuCore7"><strong>Core 7</strong><br> <div id="systemStatsCurrentLoadCpuCore7"></div></div>

                </ul>
        </div>
    </div>
    <ul ></ul>
    <div class="wrapper " style="grid-template-rows: auto; " >
        <div class="grid2" style="margin:auto;">
            <form  id="startMining">
                    <button class="btn success" type="submit">Start Mining</button>
            </form>
        </div>
        <div class="grid3" style="margin:auto;">
            <form  id="stopMining">
                <button class="btn danger" onclick="updateMiningData()" type="submit">Stop Mining</button>
            </form>
        </div>
    </div>
    <script>

        const startMining = document.querySelector('#startMining');
        startMining.addEventListener('submit', submitForm);
        
        function submitForm(e){
            e.preventDefault();

            var miningData = [  
                document.querySelector('#miningUser').value.toString(),
                document.querySelector('#miningPool').value.toString(),
                document.querySelector('#miningAlgo').value.toString(),
                document.querySelector('#miningUserPw').value.toString(),
                document.querySelector('input[name="miningDevice"]:checked').value.toString(),
                document.getElementById("cpuThreadSliderValue").value.toString()
            ];
            ipcRenderer.send('startMining',miningData);
        }
    </script>

    <script>
        const electron = require('electron');
        const {ipcRenderer} = electron;
        const ul = document.querySelector('ul');
        const br = document.createElement('br');
        var cpuCores = 0;
        //https://www.npmjs.com/package/systeminformation
        //add systemInfoCpu
        ipcRenderer.on('systemInfoCpu', function(e, data){
            var container = document.getElementById('systemInfoCpuManufacturer');
            var itemText = document.createTextNode(data.manufacturer); container.appendChild(itemText);
            container = document.getElementById('systemInfoCpuBrand');itemText = document.createTextNode(data.brand); container.appendChild(itemText);
            container = document.getElementById('systemInfoCpuCores');itemText = document.createTextNode(data.cores); container.appendChild(itemText); cpuCores = data.cores;
            document.getElementById("cpuThreadSlider").max = data.cores;
        });
        //add systemInfoGraphics 
        ipcRenderer.on('systemInfoGraphics', function(e, data){
            var container = document.getElementById('systemInfoGraphicsVendor');
            var itemText = document.createTextNode(data.controllers[0].vendor); container.appendChild(itemText);
            container = document.getElementById('systemInfoGraphicsModel'); itemText = document.createTextNode(data.controllers[0].model); container.appendChild(itemText);
            container = document.getElementById('systemInfoGraphicsVram'); itemText = document.createTextNode(data.controllers[0].vram + ' Mb'); container.appendChild(itemText);
        });

        //add systemInfoNetworkInterfaces
        ipcRenderer.on('systemInfoNetworkInterfaces', function(e, data){
            var container = document.getElementById('systemInfoNetworkInterfacesIface');
            var itemText = document.createTextNode(data[0].iface); container.appendChild(itemText);
            container = document.getElementById('systemInfoNetworkInterfacesMac'); itemText = document.createTextNode(data[0].mac); container.appendChild(itemText);
            container = document.getElementById('systemInfoNetworkInterfacesIp'); itemText = document.createTextNode(data[0].ip4); container.appendChild(itemText);
        });

        //update miningStatsCpuHash
        ipcRenderer.on('miningStatsCpuHash', function(e, data){
            var container = document.getElementById('miningStatsCpuHash');
            container.innerHTML =  'to do ' + data[2].toString();

            var id = ['miningStatsCpuCore', data[0].toString(), 'Hash'];
            id = id.join('');
            var container = document.getElementById(id); //systemStatsCpuCore0Hash
            container.innerHTML = data[1].toString() + data[2].toString();
        });

        //update miningStatsStratumDiff
        ipcRenderer.on('miningStatsStratumDiff', function(e, data){
            var container = document.getElementById('miningStatsStratDiff');
            container.innerHTML =  data[0].toString() + ' (' + data[1].toString() + ')';

        });

        //update systemStatsCurrentLoad
        ipcRenderer.on('systemStatsCurrentLoad', function(e, data){
            var container = document.getElementById('systemStatsCurrentLoadCpu');
            container.innerHTML =  data.currentload.toFixed(2).toString() + '%';
            container.style.background = '-webkit-linear-gradient(top, #FFF  ' + (100-data.currentload.toFixed(2)).toString() + '%, #F00 100%)';


            for (i = 0; i < cpuCores;i++){
                var id = ['cpuCore', i]; id = id.join('');
                document.getElementById(id).style.background = '-webkit-linear-gradient(top, #FFF  ' + (100-data.cpus[i].load).toString() + '%, #F00 100%)';
                id = ['systemStatsCurrentLoadCpuCore', i]; id = id.join('');
                container = document.getElementById(id); container.innerHTML = data.cpus[i].load.toFixed(2).toString() + '%';
            }   
        });
        //update systemStatsCpuTemp
        ipcRenderer.on('systemStatsCpuTemp', function(e, data){
            var container = document.getElementById('systemStatsCpuTemp');
            container.innerHTML = '<strong>CPU Temp: </strong>' + data.main.toFixed(2).toString() + 'C';
            container.style.background = '-webkit-linear-gradient(top, #77F  ' + (100-data.main).toString() + 'C, #F00 100%)';
            container = document.getElementById('systemStatsCpuCore0Temp'); container.innerHTML = data.main.toFixed(2).toString() + 'C';

            for (i = 0; i < cpuCores;i++){
                var id = ['cpuCore', i,'Temp']; id = id.join('');
                document.getElementById(id).style.background = '-webkit-linear-gradient(top, #77F  ' + (100-data.cpus[i].load).toString() + '%, #F00 100%)';
                id = ['systemStatsCpuCore', i,'Temp']; id = id.join('');
                container = document.getElementById(id); container.innerHTML = data.cores[i].toFixed(2).toString() + '%';
            }   

        });
        //add item system:info
        ipcRenderer.on('item:add', function(e, item){
            ul.className = 'collection'
            const li = document.createElement('li');
            li.className = 'collection-item';
            const itemText = document.createTextNode(item);
            li.appendChild(itemText);
            ul.appendChild(li);
        });

        //clear items
        ipcRenderer.on('item:clear', function(){
            ul.innerHTML = '';
            ul.className = '';
        });

        //remove item
        ul.addEventListener('dblclick', removeItem)
        function removeItem(e){
            e.target.remove();
            if(ul.children == 0){
                ul.className = '';
            };
        };
    </script>
</body>
</html>